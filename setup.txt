https://github.com/qwc-services/qwc-docker


git clone git@github.com:qwc_services/qwc-docker.git

cd qwc-docker
cp docker-compose-example.yml docker-compose.yml
cp api-gateway/nginx-example.conf api-gateway/nginx.conf
python3 -c 'import secrets; print("JWT_SECRET_KEY=\"%s\"" % secrets.token_hex(48))' >.env

sudo chown -R 33:33 volumes/attachments
sudo chown -R 33:33 volumes/config
sudo chown -R 33:33 volumes/qgs-resources
sudo chown -R 33:33 volumes/qwc2/assets

sudo chown 8983:8983 volumes/solr/data

docker-compose up -d

=> Ab hier sollte die Test Umgebung bereits laufen:
QGIS Server WMS:
http://localhost:8088/ows/qwc_demo?SERVICE=WMS&VERSION=1.3.0&REQUEST=GetCapabilities

QWC2:
http://localhost:8088

QWC Admin:
http://localhost:8088/qwc_admin (Login mit User admin Passwort admin)

vi pg_service.conf

dort folgendes für eine DB Verbindung auf unsere Test-DB einfügen. Alternativ können Testdaten natürlich auch aus unserem Dump gezogen und in die vorhandene lokale DB qwc-postgis gespielt werden.

[pub]
host=geodb-t.rootso.org
port=5432
dbname=pub
user=sogis_service
password=yDOG6zBlPlSYGgVg9Vun
sslmode=require

[edit]
host=geodb-t.rootso.org
port=5432
dbname=edit
user=sogis_service
password=yDOG6zBlPlSYGgVg9Vun
sslmode=require

vi pg_service-write.conf

dort folgendes einfügen

[pub_write]
host=geodb-t.rootso.org
port=5432
dbname=pub
user=sogis_service_write
password=4tKvPnoGSBwCHrUDLUqo
sslmode=require

[edit_write]
host=geodb-t.rootso.org
port=5432
dbname=edit
user=sogis_service_write
password=4tKvPnoGSBwCHrUDLUqo
sslmode=require

vi volumes/config-in/default/tenantConfig.json

folgendes anpassen

permissions_default_allow muss true sein

Vor backgroundLayers ein weiteres Thema einfügen
{
  "title": "Mein toller Titel",
  "url": /ows/scan/test",
  "backgroundLayers": [
    {
       "name": "hintergrundkarte_sw"
    }
  ]
}


In backgroundLayers den Backgroundlayer hintergrundkarte_sw hinzufügen

{
  "type": "wmts",
  "url": "https://geo.so.ch/api/wmts/1.0.0/ch.so.agi.hintergrundkarte_sw/default/{TileMatrixSet}/{TileMatrix}/{TileRow}/{TileCol}.png",
  "title": "Karte SW",
  "name": "hintergrundkarte_sw",
  "tileMatrixPrefix": "",
  "tileMatrixSet": "2056",
  "originX": 2420000,
  "originY": 1350000,
  "projection": "EPSG:2056",
  "resolutions": [
    4000,
    2000,
    1000,
    500,
    250,
    100,
    50,
    20,
    10,
    5,
    2.5,
    1,
    0.5,
    0.25,
    0.1
  ],
  "tileSize": [
    256,
    256
  ],
  "thumbnail": "img/mapthumbs/hintergrundkarte_sw.png"
}
  
  In QGIS ein Projekt erstellen und als qgs abspeichern. Achtung Connection Name für die DB Connection(s) der Layer identisch denen im qwc-docker enthaltenen pg_service.conf (bspw pub).
  Das erstellte Projekt nach volumes/qgs-resources/scan kopieren. Berechtiungen korrekt (chown 33:username) setzen.
  Im AGDI unter localhost:8088/qwc_admin muss unter Resources eine Map mit Namen scan/test, bzw. scan/name_qgs_file, erfasst werden. Ausserdem muss unter Permissions 
  eine Permission für die Map (Public) erstellt werden.
  Die im qgs enthaltenen Layer müssen ebenfalls unter Resources als Layer erfasst werden. Ihnen muss als Parent die Map test zugeordnet werden. Die Namen der Layer müssen dem layername im qgs
  entsprechen. Wenn ein Layer editierbar sein soll muss für ihn auch noch eine Data Resource erfasst sein (gleicher Name wie Layer). Bei der Permission für die Data Resource 
  muss das Häkchen bei Write gesetzt werden.
  
  Copy hintergrundkarte_sw.png nach volumes/qwc2/assets/img/mapthumbs/
  
  Unter localhost:8088/qwc_admin den Config Generator starten
}
